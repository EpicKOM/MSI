{% macro render_meteo_live_page(data_status, station_data, current_weather_data, daily_extremes_data) %}
<!--    Renders the error message if the database is empty-->
    {% if data_status["is_table_empty"] %}
        <div class="container mt-4">
            <h3 class="text-center text-light-red">
                <span class="fa-stack fa-2x">
                    <i class="fas fa-database fa-stack-1x fa-inverse text-info"></i>
                    <i class="fas fa-slash fa-stack-1x text-light-red"></i>
                </span><br>
                Aucune donnée n'est actuellement disponible.<br>
                Veuillez réessayer ultérieurement.
            </h3>
        </div>
    {% else %}
<!--        Renders the main station information badges.-->
        <div class="container mt-4">
            {{ render_station_overview(data_status, station_data, current_weather_data) }}
        </div>

<!--        Renders the weather data cards (temperature, rain, etc.)-->
        <div class="container mt-3">
            <div class="row">
                {{ render_temperature_card(current_weather_data, station_data["has_trend"], daily_extremes_data) }}
                {{ render_rain_card(current_weather_data) }}
                {{ render_wind_card(current_weather_data, daily_extremes_data) }}
                {{ render_humidity_card(current_weather_data, station_data["has_dew_point"]) }}

                {% if station_data["has_pressure"] %}
                    {{ render_pressure_card(current_weather_data) }}
                {% endif %}
                {% if station_data["has_radiation"] %}
                    {{ render_radiation_card(current_weather_data) }}
                {% endif %}
            </div>
        </div>

<!--        Renders the interactive chart section with its selectors.-->
        <div class="container mt-3"
             id="live_charts_container">
            <div class="row">
                {{ render_live_chart_canvas() }}
                {{ render_live_chart_selectors(station_data) }}
            </div>
        </div>
    {% endif %}
{% endmacro %}

{% macro render_station_overview(data_status, station_data, current_weather_data) %}
    {% if not data_status["is_data_fresh"] %}
        <div class="d-flex justify-content-md-center">
            <div class="alert alert-dismissible w-40 text-center text-light-red bg-dark-red border-error" role="alert" id="weather-station-unavailable-alert" style="display: none;">
                Station météorologique indisponible.
                <a role="button" class="position-absolute end-0 me-4 text-light-red" id="weather-station-unavailable-alert-button">
                  <i class="fa-solid fa-xmark fa-lg"></i>
                </a>
            </div>
        </div>
    {% endif %}
    <div class="d-flex flex-column flex-md-row">
        <div>
            <span class="badge p-3 {% if not data_status['is_data_fresh'] %}text-light-red bg-dark-red border-error{% else %}text-light-green bg-dark-green border-achievement{% endif %}" id="liveDateTime">
                <i class="fa-solid fa-rotate-right me-2"></i>Données mises à jour le {{ format_weather_value( current_weather_data["update_datetime"]) }}
            </span>
        </div>
        <div>
            <span class="badge p-3 text-light opacity-75">
                <i class="fa-solid fa-map-pin me-2"></i>{{ station_data["city"] }}
            </span>
        </div>
        <div>
            <span class="badge p-3 text-light opacity-75">
                <i class="fa-solid fa-mountain me-2"></i>{{ station_data["elevation"] }}
            </span>
        </div>
        <div>
            <span class="badge p-3 text-light opacity-75">
                <i class="fa-solid fa-diagram-project me-2"></i>Réseau {{ station_data["network"] }}
            </span>
        </div>
    </div>
{% endmacro %}

{% macro render_temperature_card(current_weather_data, has_trend, daily_extremes_data) %}
    <div class="col-lg">
        <div class="card bg-primary-color weather-card p-3">
            <div class="d-flex align-items-start">
                <div class="flex-shrink-0">
                    <div class="p-2 badge-primary bg-secondary-color rounded-4">
                        <span class="fa-stack fa-lg fa-fw">
                            <i class="fa-solid fa-temperature-three-quarters fa-stack-1x text-light"></i>
                        </span>
                    </div>
                </div>
                <div class="flex-grow-1 ms-4">
                    <p class="text-light opacity-50 mb-1">
                        Température
                    </p>
                    <h5 class="fw-bold mb-1 text-light">
                        {{ format_weather_value(current_weather_data['temperature']) }} °C
                        {%- if has_trend and current_weather_data["temperature_trend"] == "down" -%}
                            <i class="fa-solid fa-arrow-trend-down text-info ms-2 ms-xl-1 ms-xxl-2 fs-6"></i>

                        {%- elif has_trend and current_weather_data["temperature_trend"] == "up" -%}
                            <i class="fa-solid fa-arrow-trend-up text-light-red ms-2 ms-xl-1 ms-xxl-2 fs-6"></i>
                        {% endif %}
                    </h5>
                </div>
            </div>
            <div class="d-flex flex-grow-1"></div>
            <div class="d-flex justify-content-between">
                <div class="text-light"
                     data-mdb-tooltip-init
                     title="{%- if daily_extremes_data['tmin_time'] is not none -%}{{ daily_extremes_data['tmin_time'] }}{% endif %}">
                    <i class="fa-solid fa-arrow-down text-info me-2"></i>
                    <span>
                        {{ format_weather_value(daily_extremes_data['tmin']) }} °C
                    </span>
                </div>

                <div class="text-light"
                     data-mdb-tooltip-init
                     title="{%- if daily_extremes_data['tmax_time'] is not none -%}{{ daily_extremes_data['tmax_time'] }}{% endif %}">
                    <i class="fa-solid fa-arrow-up text-light-red me-2"></i>
                    <span>
                        {{ format_weather_value(daily_extremes_data['tmax']) }} °C
                    </span>
                </div>
            </div>
        </div>
    </div>
{% endmacro %}

{% macro render_rain_card(current_weather_data) %}
    <div class="col-lg mt-lg-0 mt-3">
        <div class="card bg-primary-color weather-card p-3">
            <div class="d-flex align-items-start">
                <div class="flex-shrink-0">
                    <div class="p-2 badge-primary bg-secondary-color rounded-4">
                        <span class="fa-stack fa-lg fa-fw">
                            <i class="fa-solid fa-cloud-rain fa-stack-1x text-light"></i>
                            {%- if current_weather_data['rain_1h']|float <= 0 or current_weather_data['rain_1h'] is none -%}
                                <i class="fa-solid fa-slash fa-stack-1x text-light-red"></i>
                            {% endif %}
                        </span>
                    </div>
                </div>
                <div class="flex-grow-1 ms-4">
                    <p class="text-light opacity-50 mb-1">
                        Pluie
                    </p>
                    <h5 class="fw-bold mb-1 text-light"
                        data-mdb-tooltip-init
                        title="{%- if current_weather_data['rain_1h_date'] is not none -%}{{ current_weather_data['rain_1h_date'] }}{% endif %}">
                        {{ format_weather_value(current_weather_data['rain_1h']) }} mm/1h
                    </h5>
                </div>
            </div>
            <div class="d-flex flex-grow-1"></div>
            <div class="d-flex justify-content-between">
                <p class="small mb-0">
                    <span class="text-light">Cumul du jour :</span>
                    <span class="text-info">
                        {{ format_weather_value(current_weather_data['rain_24h']) }} mm
                    </span>
                </p>
            </div>
        </div>
    </div>
{% endmacro %}

{% macro render_wind_card(current_weather_data, daily_extremes_data) %}
    <div class="col-xl mt-xl-0 mt-3">
        <div class="card bg-primary-color weather-card p-3">
            <div class="d-flex align-items-start">
                <div class="flex-shrink-0">
                    <div class="p-2 badge-primary bg-secondary-color rounded-4">
                        <span class="fa-stack fa-lg fa-fw">
                            <i class="fa-solid fa-wind fa-stack-1x text-light"></i>
                            {%- if current_weather_data["wind_speed"]|float <= 0 or current_weather_data["wind_speed"] is none -%}
                                <i class="fa-solid fa-slash fa-stack-1x text-light-red"></i>
                            {% endif %}
                        </span>
                    </div>
                </div>
                <div class="flex-grow-1 ms-4">
                    <p class="text-light opacity-50 mb-1">
                        Vent
                    </p>
                    <h5 class="fw-bold mb-1 text-light"
                        data-mdb-tooltip-init
                        title="raf: {{ format_weather_value(current_weather_data['gust_speed']) }} km/h">
                        {{ format_weather_value(current_weather_data['wind_speed']) }} km/h
                    </h5>
                </div>
            </div>
            <div class="d-flex flex-grow-1"></div>
            <div class="d-flex justify-content-between">
                <div class="text-light"
                     data-mdb-tooltip-init
                     title="{%- if daily_extremes_data['gust_max_time'] is not none -%}{{ daily_extremes_data['gust_max_time'] }}{% endif %}">
                    <i class="fa-solid fa-location-arrow text-light-red me-2"></i>
                    <span>
                        {{ format_weather_value(daily_extremes_data['gust_max']) }} km/h
                    </span>
                </div>

                <div class="text-light"
                     data-mdb-tooltip-init
                     title="{% if current_weather_data['wind_speed'] != 0 or current_weather_data['gust_speed'] != 0 %}Angle: {{ format_weather_value(current_weather_data['wind_angle']) }} °{% endif %}">
                    <i class="fa-solid fa-compass text-light me-2"></i>
                    <span>
                        {% if current_weather_data['wind_speed'] != 0 or current_weather_data["gust_speed"] != 0 %}
                            {{ format_weather_value(current_weather_data['wind_direction']) }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
{% endmacro %}

{% macro render_humidity_card(current_weather_data, has_dew_point) %}
    <div class="col-lg mt-xl-0 mt-3">
        <div class="card bg-primary-color weather-card p-3">
            <div class="d-flex align-items-start">
                <div class="flex-shrink-0">
                    <div class="p-2 badge-primary bg-secondary-color rounded-4">
                        <span class="fa-stack fa-lg fa-fw">
                            <i class="fa-solid fa-droplet fa-stack-1x text-light"></i>
                        </span>
                    </div>
                </div>
                <div class="flex-grow-1 ms-4">
                    <p class="text-light opacity-50 mb-1">
                        Humidité
                    </p>
                    <h5 class="fw-bold mb-1 text-light">
                        {{ format_weather_value(current_weather_data['humidity']) }} %
                    </h5>
                </div>
            </div>

            {% if has_dew_point %}
                <div class="d-flex flex-grow-1"></div>
                <div class="d-flex justify-content-between">
                    <p class="small mb-0">
                        <span class="text-light">Point de rosée :</span>
                        <span class="text-dew-point-color">{{ format_weather_value(current_weather_data['dew_point']) }} °C</span>
                    </p>
                </div>
            {% endif %}
        </div>
    </div>
{% endmacro %}

{% macro render_pressure_card(current_weather_data) %}
    <div class="col-lg mt-xl-0 mt-3">
        <div class="card bg-primary-color weather-card p-3">
            <div class="d-flex align-items-start">
                <div class="flex-shrink-0">
                    <div class="p-2 badge-primary bg-secondary-color rounded-4">
                        <span class="fa-stack fa-lg fa-fw">
                            <i class="fa-solid fa-gauge fa-stack-1x text-light"></i>
                        </span>
                    </div>
                </div>
                <div class="flex-grow-1 ms-4">
                    <p class="text-light opacity-50 mb-1">
                        Pression
                    </p>
                    <h5 class="fw-bold mb-1 text-light">
                        {{ format_weather_value(current_weather_data['pressure']) }} hPa
                    </h5>
                </div>
            </div>
        </div>
    </div>
{% endmacro %}

{% macro render_radiation_card(current_weather_data) %}
    <div class="col-lg mt-xl-0 mt-3">
        <div class="card bg-primary-color weather-card p-3">
            <div class="d-flex align-items-start">
                <div class="flex-shrink-0">
                    <div class="p-2 badge-primary bg-secondary-color rounded-4">
                        <span class="fa-stack fa-lg fa-fw">
                            <i class="fa-solid fa-sun fa-stack-1x text-light"></i>
                        </span>
                    </div>
                </div>
                <div class="flex-grow-1 ms-4">
                    <p class="text-light opacity-50 mb-1">
                        Radiations
                    </p>
                    <h5 class="fw-bold mb-1 text-light">
                        {{ format_weather_value(current_weather_data['uv']) }} W/m²
                    </h5>
                </div>
            </div>
        </div>
    </div>
{% endmacro %}

{% macro render_live_chart_canvas() %}
    <div class="col-lg-9 mt-lg-0 mt-3 order-2 order-lg-1">
        <div class="card bg-primary-color p-3 msi-border">
            <h5 class="card-title text-center text-light"
                id="liveChartTitle">
            </h5>

            <canvas id="liveChart"></canvas>
        </div>
    </div>
{% endmacro %}

{% macro render_live_chart_selectors(station_data) %}
<div class="col-lg-3 order-1 order-lg-2">
    <div class="dropdown custom-dropdown w-100">
        <button
            class="btn btn-hover bg-primary-color msi-border text-light dropdown-toggle w-100 d-flex justify-content-between align-items-center"
            type="button"
            data-mdb-dropdown-init
            data-mdb-ripple-init
            data-mdb-dropdown-animation="off"
            aria-expanded="false">
            <span id="chartPeriodSelectorTitle">
                24h
            </span>
            <i class="fa-solid fa-chevron-down fa-sm"></i>
        </button>
        <ul class="dropdown-menu bg-primary-color msi-border w-100"
            aria-labelledby="dropdownMenuButton">
            <li>
                <a class="dropdown-item text-light d-flex justify-content-between align-items-center action-item chart-period-selector action-item-disabled"
                   data-value="1">
                    24h<i class="fa-solid fa-check text-success"></i>
                </a>
            </li>
            <li>
                <a class="dropdown-item text-light d-flex justify-content-between align-items-center action-item chart-period-selector"
                   data-value="2">
                    48h
                </a>
            </li>
            <li>
                <a class="dropdown-item text-light d-flex justify-content-between align-items-center action-item chart-period-selector"
                   data-value="3">
                    72h
                </a>
            </li>
            <li>
                <a class="dropdown-item text-light d-flex justify-content-between align-items-center action-item chart-period-selector"
                   data-value="7">
                    7 jours
                </a>
            </li>
        </ul>
    </div>
    <div class="card bg-primary-color p-2 msi-border mt-3">
        <div class="d-flex align-items-center rounded-3 p-3 bg-active-color border-active action-item chart-data-selector action-item-disabled"
             data-value="temperature">
            <i class="fa-solid fa-chart-line text-light fa-lg me-3"></i>
            <h6 class="text-light fw-normal mb-0">
                Température
            </h6>
        </div>
        <hr class="mt-1 mb-1">
        <div class="d-flex align-items-center rounded-3 p-3 action-item chart-data-selector"
             data-value="rain">
            <i class="fa-solid fa-chart-column text-light fa-lg me-3"></i>
            <h6 class="text-light fw-normal mb-0">
                Pluie
            </h6>
        </div>
        <hr class="mt-1 mb-1">
        <div class="d-flex align-items-center rounded-3 p-3 action-item chart-data-selector"
             data-value="wind">
            <i class="fa-solid fa-chart-line text-light fa-lg me-3"></i>
            <h6 class="text-light fw-normal mb-0">
                Vent
            </h6>
        </div>
        <hr class="mt-1 mb-1">
        <div class="d-flex align-items-center rounded-3 p-3 action-item chart-data-selector"
             data-value="wind_direction">
            <i class="fa-solid fa-chart-area text-light fa-lg me-3"></i>
            <h6 class="text-light fw-normal mb-0">
                Direction du vent
            </h6>
        </div>
        <hr class="mt-1 mb-1">
        <div class="d-flex align-items-center rounded-3 p-3 action-item chart-data-selector"
             data-value="humidity">
            <i class="fa-solid fa-chart-line text-light fa-lg me-3"></i>
            <h6 class="text-light fw-normal mb-0">
                Humidité
            </h6>
        </div>
        <hr class="mt-1 mb-1">
        {% if station_data["has_pressure"] %}
            <div class="d-flex align-items-center rounded-3 p-3 action-item chart-data-selector"
                 data-value="pressure">
                <i class="fa-solid fa-chart-line text-light fa-lg me-3"></i>
                <h6 class="text-light fw-normal mb-0">
                    Pression
                </h6>
            </div>
        {% endif %}

        {% if station_data["has_radiation"] %}
            <div class="d-flex align-items-center rounded-3 p-3 action-item chart-data-selector"
                 data-value="uv">
                <i class="fa-solid fa-chart-column text-light fa-lg me-3"></i>
                <h6 class="text-light fw-normal mb-0">
                    Radiations
                </h6>
            </div>
        {% endif %}
    </div>
</div>
{% endmacro %}

{% macro format_weather_value(value) %}
    {% if value is not none %}
        {{ value }}
    {% else %}
        -
    {% endif %}
{% endmacro %}